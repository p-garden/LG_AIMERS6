# -*- coding: utf-8 -*-
"""H2O.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1KYxSmmSe7JMmz3kA4rdX9nhnhNnvktz9
"""

from google.colab import drive
drive.mount('/content/drive')

# Commented out IPython magic to ensure Python compatibility.
# %cd /content/drive/MyDrive/AIMERS/

pip install h2o

import h2o
from h2o.automl import H2OAutoML
import pandas as pd

# ğŸ“Œ H2O ì´ˆê¸°í™”
h2o.init()

# ğŸ“Œ ë°ì´í„° ë¡œë“œ
train = pd.read_csv("data/train.csv")
test = pd.read_csv("data/test.csv")

# ğŸ”¹ ID ì»¬ëŸ¼ ë³´ì¡´
test_id = test["ID"]

# ğŸ”¹ ë¶ˆí•„ìš”í•œ ì—´ ì œê±°
train = train.drop(columns=["ID"])
test = test.drop(columns=["ID"])

# ğŸ”¹ H2O ë°ì´í„° ë³€í™˜ (ì „ì²˜ë¦¬ëŠ” H2Oê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬)
train_h2o = h2o.H2OFrame(train)
test_h2o = h2o.H2OFrame(test)

# ğŸ”¹ AutoML ëª¨ë¸ í•™ìŠµ
aml = H2OAutoML(max_runtime_secs=3600)  # ìµœëŒ€ 1ì‹œê°„ í•™ìŠµ
aml.train(x=[col for col in train.columns if col != "ì„ì‹  ì„±ê³µ ì—¬ë¶€"], y="ì„ì‹  ì„±ê³µ ì—¬ë¶€", training_frame=train_h2o)

# ğŸ“Œ í•™ìŠµ ë¡œê·¸ ì¶œë ¥
print("\nğŸ† [H2O AutoML ë¦¬ë”ë³´ë“œ]")
leaderboard = aml.leaderboard.as_data_frame()
print(leaderboard)

# ğŸ“Œ ëª¨ë¸ ì €ì¥
model_path = h2o.save_model(model=aml.leader, path="h2o_best_model", force=True)
print(f"\nğŸ’¾ [ìµœì  ëª¨ë¸ ì €ì¥ ì™„ë£Œ] ê²½ë¡œ: {model_path}")

# ì˜ˆì¸¡
preds = aml.leader.predict(test_h2o).as_data_frame().values[:, 0]

# `predict_proba`ì˜ ë°˜í™˜ê°’ì´ DataFrameì¸ì§€ NumPy ë°°ì—´ì¸ì§€ í™•ì¸ í›„ ì²˜ë¦¬
if isinstance(preds, pd.DataFrame):
    preds = preds.iloc[:, 1]  # DataFrameì´ë©´ iloc ì‚¬ìš©
else:
    preds = preds[:, 1]  # NumPy ë°°ì—´ì´ë©´ ì¼ë°˜ ì¸ë±ì‹± ì‚¬ìš©

# ğŸ“Œ ê²°ê³¼ ì €ì¥ (ID ì»¬ëŸ¼ í¬í•¨)
submission = pd.DataFrame({"ID": test["ID"], "probability": preds})

submission.to_csv("submission_h2o.csv", index=False, encoding="cp949")
print("\nâœ… [ê²°ê³¼ ì €ì¥ ì™„ë£Œ] íŒŒì¼: submission_h2o.csv")

# ğŸ“Œ H2O ì¢…ë£Œ
h2o.shutdown(prompt=False)
print("\nğŸš€ [H2O ì„¸ì…˜ ì¢…ë£Œ ì™„ë£Œ]")

from google.colab import files
files.download("submission_h2o.csv")



import h2o
from h2o.automl import H2OAutoML
import pandas as pd
from sklearn.model_selection import train_test_split

# H2O ì´ˆê¸°í™”
h2o.init()

# ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
df = pd.read_csv("data/train.csv").drop(columns=["ID"])
df = df.fillna(0)  # ê²°ì¸¡ê°’ ì²˜ë¦¬
df = pd.get_dummies(df)  # ì›-í•« ì¸ì½”ë”©

# ë°ì´í„° ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(df.drop(columns=["ì„ì‹  ì„±ê³µ ì—¬ë¶€"]), df["ì„ì‹  ì„±ê³µ ì—¬ë¶€"], test_size=0.2, random_state=42)


# H2O ë°ì´í„° ë³€í™˜
train_h2o = h2o.H2OFrame(pd.concat([X_train, y_train], axis=1))
test_h2o = h2o.H2OFrame(X_test)

# AutoML ëª¨ë¸ í•™ìŠµ
aml = H2OAutoML(max_runtime_secs=3600)  # ìµœëŒ€ 1ì‹œê°„ í•™ìŠµ
aml.train(x=X_train.columns.tolist(), y="ì„ì‹  ì„±ê³µ ì—¬ë¶€", training_frame=train_h2o)

# ì˜ˆì¸¡ ë° ì €ì¥
preds = aml.leader.predict(test_h2o).as_data_frame().values[:, 0]
submission = pd.DataFrame({"ID": range(len(preds)), "ì„ì‹  ì„±ê³µ ì—¬ë¶€": preds})
submission.to_csv("submission_h2o.csv", index=False)

print("âœ… H2O AutoML ì™„ë£Œ!")
h2o.shutdown(prompt=False)