# -*- coding: utf-8 -*-
"""MLJAR Supervised.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1DK3hqv1FiPfq8BI_PztJlwkNPzn8e4rU
"""

from google.colab import drive
drive.mount('/content/drive')

# Commented out IPython magic to ensure Python compatibility.
# %cd /content/drive/MyDrive/AIMERS/

pip install mljar-supervised

from supervised.automl import AutoML
import pandas as pd
from sklearn.model_selection import train_test_split
import category_encoders as ce
# ğŸ“Œ ë°ì´í„° ë¡œë“œ
train = pd.read_csv("data/train.csv")
test = pd.read_csv("data/test.csv")

# ğŸ”¹ ID ì»¬ëŸ¼ ì €ì¥
test_id = test["ID"]

# ğŸ”¹ ë¶ˆí•„ìš”í•œ ì—´ ì œê±° (IDëŠ” í•™ìŠµì— í•„ìš” ì—†ìŒ)
train = train.drop(columns=["ID"])
test = test.drop(columns=["ID"])

# ğŸ”¹ íŠ¹ì§•(X)ì™€ íƒ€ê²Ÿ(y) ë¶„ë¦¬
X_train = train.drop(columns=["ì„ì‹  ì„±ê³µ ì—¬ë¶€"])
y_train = train["ì„ì‹  ì„±ê³µ ì—¬ë¶€"]

# âœ… **íƒ€ê¹ƒ ì¸ì½”ë”© ì ìš© (ì¹´í…Œê³ ë¦¬í˜• ë³€ìˆ˜ ë³€í™˜)**
categorical_cols = X_train.select_dtypes(include=["object"]).columns.tolist()

# Target Encoding ìˆ˜í–‰
target_encoder = ce.TargetEncoder(cols=categorical_cols, smoothing=0.3)
X_train[categorical_cols] = target_encoder.fit_transform(X_train[categorical_cols], y_train)
X_test[categorical_cols] = target_encoder.transform(X_test[categorical_cols])
print(f"âœ… íƒ€ê¹ƒ ì¸ì½”ë”© ì ìš©ëœ ì»¬ëŸ¼: {categorical_cols}")

automl = AutoML(
    mode="Compete",
    total_time_limit=10800,
    golden_features=True,  # ì¤‘ìš”í•œ í”¼ì²˜ ìƒì„±
    kmeans_features=True,  # K-means ê¸°ë°˜ í”¼ì²˜ ìƒì„±
    mix_encoding=True,  # ë‹¤ì–‘í•œ ì¸ì½”ë”© ì ìš©
    #    eval_metric="auc"  # í‰ê°€ ê¸°ì¤€ì„ ROC-AUCë¡œ ì„¤ì •

)

automl.fit(X_train, y_train)

import pandas as pd
import category_encoders as ce
import joblib

# ğŸ“Œ ë°ì´í„° ë¡œë“œ
train = pd.read_csv("data/train.csv")
test = pd.read_csv("data/test.csv")

# ğŸ“Œ ID ì»¬ëŸ¼ ì €ì¥
test_id = test["ID"]

# ğŸ“Œ ID ì œê±°
train = train.drop(columns=["ID"])
test = test.drop(columns=["ID"])

# ğŸ“Œ íƒ€ê²Ÿ ë¶„ë¦¬
X_train = train.drop(columns=["ì„ì‹  ì„±ê³µ ì—¬ë¶€"])
y_train = train["ì„ì‹  ì„±ê³µ ì—¬ë¶€"]
X_test = test.copy()

# âœ… Trainê³¼ Testì˜ ì¹´í…Œê³ ë¦¬í˜• ë³€ìˆ˜ ë™ì¼í•˜ê²Œ ìœ ì§€
categorical_cols = list(set(X_train.select_dtypes(include=["object"]).columns) | set(X_test.select_dtypes(include=["object"]).columns))
print(f"âœ… ì¹´í…Œê³ ë¦¬í˜• ë³€ìˆ˜: {categorical_cols}")

# âœ… **íƒ€ê¹ƒ ì¸ì½”ë”© ì ìš©**
target_encoder = ce.TargetEncoder(cols=categorical_cols, smoothing=0.3)
X_train[categorical_cols] = target_encoder.fit_transform(X_train[categorical_cols], y_train)
X_test[categorical_cols] = target_encoder.transform(X_test[categorical_cols])

# âœ… íƒ€ê¹ƒ ì¸ì½”ë” ë° ì¹´í…Œê³ ë¦¬ ë³€ìˆ˜ ì €ì¥ (ì¶”í›„ ì‚¬ìš©)
joblib.dump(target_encoder, "target_encoder.pkl")
joblib.dump(categorical_cols, "categorical_cols.pkl")
print("âœ… íƒ€ê¹ƒ ì¸ì½”ë” ë° ì»¬ëŸ¼ ì •ë³´ ì €ì¥ ì™„ë£Œ!")

# ğŸ“Œ ì¸ì½”ë” ë° ì»¬ëŸ¼ ì •ë³´ ë¡œë“œ
target_encoder = joblib.load("target_encoder.pkl")
categorical_cols = joblib.load("categorical_cols.pkl")
print("âœ… íƒ€ê¹ƒ ì¸ì½”ë” ë° ì»¬ëŸ¼ ì •ë³´ ë¡œë“œ ì™„ë£Œ")

# ğŸ“Œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ë¡œë“œ
test = pd.read_csv("data/test.csv")
X_test = test.drop(columns=["ID"])

# ğŸ“Œ ì¹´í…Œê³ ë¦¬ ì»¬ëŸ¼ íƒ€ê¹ƒ ì¸ì½”ë”© ì ìš©
X_test[categorical_cols] = target_encoder.transform(X_test[categorical_cols])

# ğŸ“Œ ì˜ˆì¸¡ ìˆ˜í–‰
preds = automl.predict_proba(X_test)[:, 1]

# ğŸ“Œ ê²°ê³¼ ì €ì¥
submission = pd.DataFrame({"ID": test_id, "probability": preds})
submission.to_csv("submission_mljar.csv", index=False, encoding="utf-8-sig")

print("\nâœ… [ê²°ê³¼ ì €ì¥ ì™„ë£Œ] íŒŒì¼: submission_mljar.csv")

# ğŸ“Œ ê²°ê³¼ ì €ì¥ (ID ì»¬ëŸ¼ í¬í•¨)
submission = pd.DataFrame({"ID": test_id, "probability": preds})
submission.to_csv("submission_mljar.csv", index=False, encoding="cp949")
print("\nâœ… [ê²°ê³¼ ì €ì¥ ì™„ë£Œ] íŒŒì¼: submission_mljar.csv")

submission

from google.colab import files
files.download("submission_mljar.csv")



from supervised.automl import AutoML
import pandas as pd
from sklearn.model_selection import train_test_split

# ë°ì´í„° ë¡œë“œ
df = pd.read_csv("data/train.csv")

# ë°ì´í„° ë¶„í• 
X_train, X_test, y_train, y_test = train_test_split(df.drop(columns=["ì„ì‹  ì„±ê³µ ì—¬ë¶€"]), df["ì„ì‹  ì„±ê³µ ì—¬ë¶€"], test_size=0.2, random_state=42)

# MLJAR AutoML í•™ìŠµ
automl = AutoML(mode="Compete", total_time_limit=3600)
automl.fit(X_train, y_train)

# ì˜ˆì¸¡
preds = automl.predict_proba(X_test)[:, 1]

# ê²°ê³¼ ì €ì¥
submission = pd.DataFrame({"ID": X_test["ID"], "ì„ì‹  ì„±ê³µ ì—¬ë¶€": preds})
submission.to_csv("submission_mljar.csv", index=False)

print("âœ… MLJAR AutoML ì™„ë£Œ!")

